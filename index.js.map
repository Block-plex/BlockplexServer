{"mappings":"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","sources":["server.js"],"sourcesContent":["import http from \"http\";\r\nimport { WebSocketServer } from \"ws\";\r\n\r\nconst PORT = process.env.PORT || 3000;\r\n\r\nlet players = {};\r\n\r\nimport * as CANNON from \"cannon-es\";\r\n\r\nconst world = new CANNON.World({\r\n  gravity: new CANNON.Vec3(0, -9.82, 0)\r\n});\r\n\r\nconst fixedTimeStep = 1 / 60;\r\n\r\nfunction createCapsule(radius, height) {\r\n  const sphereShape = new CANNON.Sphere(radius);\r\n  const cylinderShape = new CANNON.Cylinder(radius, radius, height, 8);\r\n\r\n  const quat = new CANNON.Quaternion();\r\n  quat.setFromEuler(Math.PI / 2, 0, 0);\r\n\r\n  const compound = new CANNON.Body({ mass: 1 });\r\n\r\n  compound.addShape(cylinderShape, new CANNON.Vec3(0, 0, 0), quat);\r\n  compound.addShape(sphereShape, new CANNON.Vec3(0, height / 2, 0));\r\n  compound.addShape(sphereShape, new CANNON.Vec3(0, -height / 2, 0));\r\n\r\n  return compound;\r\n}\r\n\r\n// HTTP server (for the status page)\r\nconst server = http.createServer((req, res) => {\r\n  res.writeHead(200, { \"Content-Type\": \"text/html\" });\r\n  res.end(`\r\n    <html>\r\n      <head>\r\n        <title>Blockplex Server</title>\r\n        <style>\r\n          body {\r\n            background: #111;\r\n            color: #0f0;\r\n            font-family: monospace;\r\n            text-align: center;\r\n            padding-top: 100px;\r\n          }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        <h1>Blockplex Multiplayer Server</h1>\r\n        <p>Status: Online</p>\r\n        <h1>Blockplex Server</h1>\r\n        <p>Players online: ${Object.keys(players).length}</p>\r\n      </body>\r\n    </html>\r\n  `);\r\n});\r\n\r\nsetInterval(() => {\r\nfor (const id in players) {\r\n  const p = players[id];\r\n  const body = p.body;\r\n  const input = p.input;\r\n\r\n  const speed = 10;\r\n\r\n  // Reset horizontal velocity\r\n  body.velocity.x = 0;\r\n  body.velocity.z = 0;\r\n\r\n  if (input.w) {\r\n    body.velocity.z = -speed * Math.cos(input.angle * Math.PI/180);\r\n    body.velocity.x = -speed * Math.sin(input.angle * Math.PI/180);\r\n  }\r\n  if (input.s) {\r\n    body.velocity.z = speed * Math.cos(input.angle * Math.PI/180);\r\n    body.velocity.x = speed * Math.sin(input.angle * Math.PI/180);\r\n  }\r\n  if (input.a) {\r\n    body.velocity.x = -speed * Math.cos(input.angle * Math.PI/180);\r\n    body.velocity.z = speed * Math.sin(input.angle * Math.PI/180);\r\n  }\r\n  if (input.d) {\r\n    body.velocity.x = speed * Math.cos(input.angle * Math.PI/180);\r\n    body.velocity.z = -speed * Math.sin(input.angle * Math.PI/180);\r\n  }\r\n}\r\n}, 1000);\r\n\r\nsetInterval(() => {\r\n  world.step(fixedTimeStep);\r\n\r\n  const snapshot = {};\r\n\r\n  for (const id in players) {\r\n    const body = players[id].body;\r\n\r\n    snapshot[id] = {\r\n      x: body.position.x,\r\n      y: body.position.y,\r\n      z: body.position.z,\r\n      qx: body.quaternion.x,\r\n      qy: body.quaternion.y,\r\n      qz: body.quaternion.z,\r\n      qw: body.quaternion.w\r\n    };\r\n  }\r\n\r\n  wss.clients.forEach(c => c.send(JSON.stringify(snapshot)));\r\n}, 16);\r\n\r\n// WebSocket server\r\nconst wss = new WebSocketServer({ server });\r\n\r\nwss.on(\"connection\", (socket) => {\r\n  const id = Math.random().toString(36).slice(2);\r\n  const body = createCapsule(1.5, 12);\r\n  body.position.set(0, 10, 0);\r\n  world.addBody(body);\r\n\r\n  players[id] = {\r\n    body,\r\n    input: { w:0, a:0, s:0, d:0 }\r\n  };\r\n\r\n  // Send the ID to the client\r\n  socket.send(JSON.stringify({ type: \"id\", id }));\r\n\r\n  socket.on(\"message\", (msg) => {\r\n    try {\r\n      const data = JSON.parse(msg);\r\n\r\n      if (data.type === \"input\") {\r\n        players[id].input = data;\r\n      }\r\n      console.log(\"Received message from\", id, \":\", data);\r\n    } catch {}\r\n  });\r\n\r\n  socket.on(\"close\", () => {\r\n    delete players[id];\r\n  });\r\n});\r\n\r\nserver.listen(PORT, () => {\r\n  console.log(\"Listening on port\", PORT);\r\n});\r\n"],"names":[],"version":3,"file":"index.js.map"}