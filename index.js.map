{"mappings":"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","sources":["server.js"],"sourcesContent":["import http from \"http\";\r\nimport { WebSocketServer } from \"ws\";\r\n\r\nconst PORT = process.env.PORT || 3000;\r\n\r\nlet players = {};\r\n\r\nimport * as CANNON from \"cannon-es\";\r\n\r\nconst world = new CANNON.World({\r\n  gravity: new CANNON.Vec3(0, -9.82, 0)\r\n});\r\n\r\nconst fixedTimeStep = 1 / 60;\r\n\r\nfunction createCapsule(radius, height) {\r\n  const sphereShape = new CANNON.Sphere(radius);\r\n  const cylinderShape = new CANNON.Cylinder(radius, radius, height, 8);\r\n\r\n  const quat = new CANNON.Quaternion();\r\n  quat.setFromEuler(Math.PI / 2, 0, 0);\r\n\r\n  const compound = new CANNON.Body({ mass: 1 });\r\n\r\n  compound.addShape(cylinderShape, new CANNON.Vec3(0, 0, 0), quat);\r\n  compound.addShape(sphereShape, new CANNON.Vec3(0, height / 2, 0));\r\n  compound.addShape(sphereShape, new CANNON.Vec3(0, -height / 2, 0));\r\n\r\n  return compound;\r\n}\r\n\r\n// HTTP server (for the status page)\r\nconst server = http.createServer((req, res) => {\r\n  res.writeHead(200, { \"Content-Type\": \"text/html\" });\r\n  res.end(`\r\n    <html>\r\n      <head>\r\n        <title>Blockplex Server</title>\r\n        <style>\r\n          body {\r\n            background: #111;\r\n            color: #0f0;\r\n            font-family: monospace;\r\n            text-align: center;\r\n            padding-top: 100px;\r\n          }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        <h1>Blockplex Multiplayer Server</h1>\r\n        <p>Status: Online</p>\r\n        <h1>Blockplex Server</h1>\r\n        <p>Players online: ${Object.keys(players).length}</p>\r\n      </body>\r\n    </html>\r\n  `);\r\n});\r\n\r\nclass CollisionBox {\r\n    constructor(width, height, length, x, y, z, whenCollide, color, masss = 0) {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.length = length;\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.whenCollide = whenCollide;\r\n        this.physics = new CANNON.Body({\r\n            mass: masss,\r\n            shape: new CANNON.Box(new CANNON.Vec3(width/2, height/2, length/2)),\r\n            position: new CANNON.Vec3(x, y, z)\r\n        });\r\n        world.addBody(this.physics);\r\n    }\r\n}\r\n\r\nsetInterval(() => {\r\n  world.step(fixedTimeStep);\r\n\r\n  const snapshot = { boxes: [], players: {} };\r\n\r\n  for (let i = 0; i < boxes.length; i++) {\r\n    const b = boxes[i];\r\n    snapshot.boxes.push({\r\n      x: b.physics.position.x,\r\n      y: b.physics.position.y,\r\n      z: b.physics.position.z,\r\n      qx: b.physics.quaternion.x,\r\n      qy: b.physics.quaternion.y,\r\n      qz: b.physics.quaternion.z,\r\n      qw: b.physics.quaternion.w\r\n    });\r\n  }\r\n\r\n  for (const id in players) {\r\n    const p = players[id];\r\n    snapshot.players[id] = {\r\n      x: p.input.x,\r\n      y: p.input.y,\r\n      z: p.input.z,\r\n      angle: p.input.angle\r\n    };\r\n  }\r\n\r\n  wss.clients.forEach(c => c.send(JSON.stringify(snapshot)));\r\n}, 16);\r\n\r\n// WebSocket server\r\nconst wss = new WebSocketServer({ server });\r\n\r\nconst boxCol = new CollisionBox(15, 5, 15, 0, -30, 0, function() {}, 0x00FF00);\r\nconst boxCol2 = new CollisionBox(10, 5, 10, 20, -30, 0, function() {}, 0x00FF00);\r\nconst boxCol3 = new CollisionBox(10, 5, 10, 40, -30, 0, function() {}, 0x00FF00);\r\nconst boxCol4 = new CollisionBox(10, 7, 10, 60, -30, 0, function() {}, 0x00FF00);\r\nconst boxCol5 = new CollisionBox(10, 25, 10, 80, -30, 0, function() {\r\n    plr.x = 0;\r\n    plr.y = 0;\r\n    plr.z = 0;\r\n}, 0xFFAA00);\r\nconst boxCol6 = new CollisionBox(10, 25, 10, 60, -30, 15, function() {}, 0x00FF00);\r\nconst boxCol7 = new CollisionBox(10, 25, 10, 60, -30, -15, function() {}, 0x00FF00);\r\nconst boxCol8 = new CollisionBox(250, 5, 250, 0, -60, 0, function() {\r\n    plr.x = 0;\r\n    plr.y = 0;\r\n    plr.z = 0;\r\n}, 0xFF0000);\r\nconst boxCol9 = new CollisionBox(5, 5, 5, 57, 30, 8, function() {}, 0xFF00FF, 1);\r\nconst boxCol10 = new CollisionBox(5, 5, 5, 57, 40, 8, function() {}, 0xFF00FF, 1);\r\nconst boxCol11 = new CollisionBox(5, 5, 5, 57, 50, 8, function() {}, 0xFF00FF, 1);\r\nconst boxCol12 = new CollisionBox(5, 5, 5, 57, 60, 8, function() {}, 0xFF00FF, 1);\r\nconst boxCol13 = new CollisionBox(5, 5, 5, 57, 70, 8, function() {}, 0xFF00FF, 1);\r\nconst boxCol14 = new CollisionBox(10, 25, 10, 120, -30, 0, function() {\r\n    plr.x = 0;\r\n    plr.y = 0;\r\n    plr.z = 0;\r\n}, 0x00FF00);\r\nconst boxCol15 = new CollisionBox(40, 0.5, 1, 100, 70, 0, function() {}, 0xFF00FF, 1);\r\n\r\nconst boxes = [boxCol, boxCol2, boxCol3, boxCol4, boxCol5, boxCol6, boxCol7, boxCol8, boxCol9, boxCol10, boxCol11, boxCol12, boxCol13, boxCol14, boxCol15];\r\n\r\nwss.on(\"connection\", (socket) => {\r\n  const id = Math.random().toString(36).slice(2);\r\n  /* what player sends:\r\nsocket.send(JSON.stringify({\r\n        type: \"input\",\r\n        x: plr.x,\r\n        y: plr.y,\r\n        z: plr.z,\r\n        angle: cameraLookaroundAngle\r\n        }));\r\n  */\r\n\r\n  players[id] = {\r\n    input: { x: 0, y: 0, z: 0, angle: 0, body: createCapsule(1.5, 12) }\r\n  };\r\n\r\n  world.addBody(players[id].input.body);\r\n  const body = players[id].input.body;\r\n\r\n  // Send the ID to the client\r\n  socket.send(JSON.stringify({ type: \"id\", id }));\r\n\r\n  socket.on(\"message\", (msg) => {\r\n    try {\r\n      const data = JSON.parse(msg);\r\n\r\n      if (data.type === \"input\") {\r\n        players[id].input = data;\r\n        body.position.x = data.x;\r\n        body.position.y = data.y;\r\n        body.position.z = data.z;\r\n        body.quaternion.setFromEuler(0, data.angle, 0);\r\n      }\r\n      console.log(\"Received message from\", id, \":\", data);\r\n    } catch {}\r\n  });\r\n\r\n  socket.on(\"close\", () => {\r\n    delete players[id];\r\n  });\r\n});\r\n\r\nserver.listen(PORT, () => {\r\n  console.log(\"Listening on port\", PORT);\r\n});\r\n"],"names":[],"version":3,"file":"index.js.map"}